{% extends 'default.html' %}
{% load censor_filters %}

{% block title %}–í—Å–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto;">
    <h2>–°–ø–∏—Å–æ–∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–π</h2>

    {% if user.is_authenticated and is_author %}
        <div class="create-buttons">
            <a href="{% url 'news_create' %}" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å</a>
            <a href="{% url 'article_create' %}" class="btn btn-success">–°–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç—å—é</a>
        </div>
    {% elif user.is_authenticated %}
        <div class="alert alert-info">
            <p>–•–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤–æ—Å—Ç–∏ –∏ —Å—Ç–∞—Ç—å–∏?
               <a href="{% url 'become_author' %}" class="btn btn-warning">–°—Ç–∞—Ç—å –∞–≤—Ç–æ—Ä–æ–º</a>
            </p>
        </div>
    {% endif %}

    {% for post in posts %}
        <div class="news-item">
            <h3>
                <a href="{% url 'news_detail' post.pk %}">
                    {{ post.title|censor }}
                </a>
                <small style="color: #666; font-weight: normal;">
                    {% if post.post_type == 'NW' %}
                        (–ù–æ–≤–æ—Å—Ç—å)
                    {% else %}
                        (–°—Ç–∞—Ç—å—è)
                    {% endif %}
                </small>
            </h3>

            <p><strong>–ê–≤—Ç–æ—Ä:</strong> {{ post.author.user.username }}</p>
            <p><strong>–î–∞—Ç–∞:</strong> {{ post.created_at|date:"d.m.Y H:i" }}</p>
            <p>{{ post.content|truncatechars:150|censor }}</p>

            <!-- –°—Å—ã–ª–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
            <div class="actions">
                {% if post.author.user == user or user.is_superuser %}
                    {% if post.post_type == 'NW' %}
                        <a href="{% url 'news_edit' post.pk %}">
                            ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                            {% if user.is_superuser and post.author.user != user %}

                            {% endif %}
                        </a>
                        <a href="{% url 'news_delete' post.pk %}" style="color: #dc3545;">
                            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                            {% if user.is_superuser and post.author.user != user %}

                            {% endif %}
                        </a>
                    {% else %}
                        <a href="{% url 'article_edit' post.pk %}">
                            ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                            {% if user.is_superuser and post.author.user != user %}

                            {% endif %}
                        </a>
                        <a href="{% url 'article_delete' post.pk %}" style="color: #dc3545;">
                            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                            {% if user.is_superuser and post.author.user != user %}

                            {% endif %}
                        </a>
                    {% endif %}
                {% else %}
                    <small style="color: #666;">(–ù–µ –≤–∞—à–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏—è)</small>
                {% endif %}
            </div>
        </div>
    {% empty %}
        <div class="news-item" style="text-align: center;">
            <p>–ü—É–±–ª–∏–∫–∞—Ü–∏–π –ø–æ–∫–∞ –Ω–µ—Ç.</p>
            <p><a href="{% url 'news_create' %}">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –Ω–æ–≤–æ—Å—Ç—å</a></p>
        </div>
    {% endfor %}

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    {% if page_obj.has_other_pages %}
    <div class="pagination">
        <span class="step-links">
            {% if page_obj.has_previous %}
                <a href="?page=1">&laquo; –ø–µ—Ä–≤–∞—è</a>
                <a href="?page={{ page_obj.previous_page_number }}">–ø—Ä–µ–¥—ã–¥—É—â–∞—è</a>
            {% endif %}

            <span class="current">
                –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}
            </span>

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}">—Å–ª–µ–¥—É—é—â–∞—è</a>
                <a href="?page={{ page_obj.paginator.num_pages }}">–ø–æ—Å–ª–µ–¥–Ω—è—è &raquo;</a>
            {% endif %}
        </span>
    </div>
    {% endif %}
</div>
{% endblock %}