{% extends 'default.html' %}
{% load censor_filters %}
{% load cache %}

{% block title %}–í—Å–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto;">
    <h2>–°–ø–∏—Å–æ–∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–π</h2>

    <!-- –ë–ª–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ -->
    {% if user.is_authenticated %}
    <div class="subscription-management" style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
        <a href="{% url 'my_subscriptions' %}" class="btn btn-info">üìß –ú–æ–∏ –ø–æ–¥–ø–∏—Å–∫–∏</a>
        <small style="color: #666; margin-left: 10px;">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</small>
    </div>
    {% endif %}

    {% if user.is_authenticated and is_author %}
        <div class="create-buttons">
            <a href="{% url 'news_create' %}" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å</a>
            <a href="{% url 'article_create' %}" class="btn btn-success">–°–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç—å—é</a>
        </div>
    {% elif user.is_authenticated %}
        <div class="alert alert-info">
            <p>–•–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤–æ—Å—Ç–∏ –∏ —Å—Ç–∞—Ç—å–∏?
               <a href="{% url 'become_author' %}" class="btn btn-warning">–°—Ç–∞—Ç—å –∞–≤—Ç–æ—Ä–æ–º</a>
            </p>
        </div>
    {% endif %}

    <!-- –ö—ç—à–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–π –Ω–∞ 20—Å–µ–∫ -->
    {% cache 20 news_list page_obj.number %}
    {% for post in page_obj %}
        <div class="news-item">
            <h3>
                <a href="
                    {% if post.post_type == 'NW' %}
                        {% url 'news_detail' post.pk %}
                    {% else %}
                        {% url 'article_detail' post.pk %}
                    {% endif %}
                ">
                    {{ post.title|censor }}
                </a>
                <small style="color: #666; font-weight: normal;">
                    {% if post.post_type == 'NW' %}
                        (–ù–æ–≤–æ—Å—Ç—å)
                    {% else %}
                        (–°—Ç–∞—Ç—å—è)
                    {% endif %}
                </small>
            </h3>

            <p><strong>–ê–≤—Ç–æ—Ä:</strong> {{ post.author.user.username }}</p>
            <p><strong>–î–∞—Ç–∞:</strong> {{ post.created_at|date:"d.m.Y H:i" }}</p>
            <p>{{ post.content|truncatechars:150|censor }}</p>

            <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –∫–Ω–æ–ø–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ -->
            {% if post.category %}
            <div class="categories" style="margin: 10px 0;">
                <strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong>
                <span class="badge" style="background: #6c757d; color: white; padding: 5px 10px; border-radius: 4px; margin: 2px; display: inline-block;">
                    {{ post.category.name }}
                    {% if user.is_authenticated %}
                        {% if user in post.category.subscribers.all %}
                            <a href="{% url 'unsubscribe_from_category' category.id %}"
                               style="color: white; margin-left: 5px; text-decoration: none;"
                               title="–û—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ {{ post.category.name }}">
                                ‚úï
                            </a>
                        {% else %}
                            <a href="{% url 'subscribe_to_category' category.id %}"
                               style="color: white; margin-left: 5px; text-decoration: none;"
                               title="–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é {{ post.category.name }}">
                                +
                            </a>
                        {% endif %}
                    {% endif %}
                </span>
            </div>
            {% endif %}

            <!-- –°—Å—ã–ª–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
            <div class="actions">
                {% if post.author.user == user or user.is_superuser %}
                    {% if post.post_type == 'NW' %}
                        <a href="{% url 'news_update' post.pk %}">
                            ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                            {% if user.is_superuser and post.author.user != user %}
                                (–∞–¥–º–∏–Ω)
                            {% endif %}
                        </a>
                        <a href="{% url 'news_delete' post.pk %}" style="color: #dc3545;">
                            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                            {% if user.is_superuser and post.author.user != user %}
                                (–∞–¥–º–∏–Ω)
                            {% endif %}
                        </a>
                    {% else %}
                        <a href="{% url 'article_update' post.pk %}">
                            ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                            {% if user.is_superuser and post.author.user != user %}
                                (–∞–¥–º–∏–Ω)
                            {% endif %}
                        </a>
                        <a href="{% url 'article_delete' post.pk %}" style="color: #dc3545;">
                            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                            {% if user.is_superuser and post.author.user != user %}
                                (–∞–¥–º–∏–Ω)
                            {% endif %}
                        </a>
                    {% endif %}
                {% else %}
                    <small style="color: #666;">(–ù–µ –≤–∞—à–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏—è)</small>
                {% endif %}
            </div>
        </div>
    {% empty %}
        <div class="news-item" style="text-align: center;">
            <p>–ü—É–±–ª–∏–∫–∞—Ü–∏–π –ø–æ–∫–∞ –Ω–µ—Ç.</p>
            {% if user.is_authenticated and is_author %}
                <p><a href="{% url 'news_create' %}">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –Ω–æ–≤–æ—Å—Ç—å</a></p>
            {% endif %}
        </div>
    {% endfor %}
    {% endcache %}

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    {% if page_obj.has_other_pages %}
    <div class="pagination">
        <span class="step-links">
            {% if page_obj.has_previous %}
                <a href="?page=1">&laquo; –ø–µ—Ä–≤–∞—è</a>
                <a href="?page={{ page_obj.previous_page_number }}">–ø—Ä–µ–¥—ã–¥—É—â–∞—è</a>
            {% endif %}

            <span class="current">
                –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}
            </span>

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}">—Å–ª–µ–¥—É—é—â–∞—è</a>
                <a href="?page={{ page_obj.paginator.num_pages }}">–ø–æ—Å–ª–µ–¥–Ω—è—è &raquo;</a>
            {% endif %}
        </span>
    </div>
    {% endif %}
</div>

<style>
.news-item {
    border: 1px solid #ddd;
    padding: 20px;
    margin: 15px 0;
    border-radius: 8px;
    background: white;
}

.news-item h3 {
    margin-top: 0;
    color: #333;
}

.news-item h3 a {
    text-decoration: none;
    color: #007bff;
}

.news-item h3 a:hover {
    text-decoration: underline;
}

.actions a {
    margin-right: 15px;
    text-decoration: none;
    color: #007bff;
}

.actions a:hover {
    text-decoration: underline;
}

.pagination {
    text-align: center;
    margin: 30px 0;
}

.pagination a {
    margin: 0 5px;
    padding: 5px 10px;
    text-decoration: none;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.pagination a:hover {
    background: #f8f9fa;
}

.pagination .current {
    margin: 0 10px;
    font-weight: bold;
}

.btn {
    display: inline-block;
    padding: 8px 16px;
    margin: 5px;
    text-decoration: none;
    border-radius: 4px;
    border: none;
    cursor: pointer;
}

.btn-primary { background: #007bff; color: white; }
.btn-success { background: #28a745; color: white; }
.btn-warning { background: #ffc107; color: black; }
.btn-info { background: #17a2b8; color: white; }
.btn-danger { background: #dc3545; color: white; }

.alert {
    padding: 15px;
    border-radius: 8px;
    margin: 15px 0;
}

.alert-info {
    background: #d1ecf1;
    color: #0c5460;
    border: 1px solid #bee5eb;
}
</style>
{% endblock %}